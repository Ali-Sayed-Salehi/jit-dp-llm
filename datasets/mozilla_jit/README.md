# `mozilla_jit` dataset

Mozilla JIT-style bug dataset that links Bugzilla bugs to the *net code diff* that landed for that
bug in Mozilla’s `autoland` Mercurial repository.

This directory contains:
- Raw Bugzilla bug metadata (`all_bugs.jsonl`)
- Raw Mercurial commit metadata (`all_commits.jsonl`)
- A joined bug+diff dataset (`mozilla_jit_2022.jsonl`)
- An LLM-ready structured-diff dataset (`jit_llm_struc_2022.jsonl`)

For script-level documentation of the extraction pipeline, see:
- `data_extraction/bugzilla/README.md`
- `data_extraction/mercurial/README.md`

## Files and schema

### `all_bugs.jsonl` (JSONL)

**What it is:** Bugzilla bugs fetched via Bugzilla REST API with a fixed field set.

**Produced by:** `data_extraction/bugzilla/get_all_bugs.py`

**Used by:** `data_extraction/mercurial/link_bug_diffs.py`

**Per-line object fields (8):**
- `id` (int)
- `type` (str)
- `regressed_by` (list[int])
- `regressions` (list[int])
- `resolution` (str)
- `product` (str)
- `component` (str)
- `creation_time` (str / ISO timestamp)

### `all_commits.jsonl` (JSONL)

**What it is:** Mercurial `autoland` commit metadata exported from `hg log -Tjson -r all()`.

**Produced by:** `data_extraction/mercurial/fetch_all_commit.py` (writes to `datasets/mozilla_perf/all_commits.jsonl`;
you can copy/symlink it here for `link_bug_diffs.py`)

**Used by:** `data_extraction/mercurial/link_bug_diffs.py`

**Per-line object fields (4):** `node` (str), `desc` (str), `date` (`[epoch_seconds, tz_offset_seconds]`), `parents` (list[str])

### `mozilla_jit_2022.jsonl` (JSONL)

**What it is:** Joined bug+diff dataset: one record per bug with a non-empty diff computed from a
contiguous block of `Bug <id>` commits.

**Produced by:** `data_extraction/mercurial/link_bug_diffs.py` (writes `datasets/mozilla_jit/mozilla_jit.jsonl`;
this file is a year-specific snapshot with the same schema)

**Used by:** `data_extraction/data_preparation.py` (mode `mozilla_jit_struc`, expects `mozilla_jit.jsonl`)

**Per-line object fields (10):**
- `bug_id` (str)
- `regressed_by` (list[str]): bug ids that regressed this bug (filtered to known ids)
- `regressions` (list[str]): bug ids regressed by this bug (filtered to known ids)
- `diff` (str): unified diff text for the net change (`hg diff -r <p1(oldest)> -r <newest>`)
- `commit_message` (str): concatenated/cleaned commit messages for the block
- `revision` (str): newest commit hash in the contiguous block
- `last_commit_date` (str / ISO timestamp)
- `bug_creation_time` (str / ISO timestamp; Bugzilla `Z` normalized to `+00:00`)
- `regression` (bool): `True` iff `regressed_by` is non-empty
- `regressor` (bool): `True` iff `regressions` is non-empty

### `jit_llm_struc_2022.jsonl` (JSONL)

**What it is:** LLM-ready classification dataset derived from the joined dataset.

**Produced by:** `data_extraction/data_preparation.py` (mode `mozilla_jit_struc`;
current script writes `jit_llm_struc_2025.jsonl`, this is an earlier snapshot)

**Per-line object fields (3):**
- `commit_id` (str): same as `revision`
- `prompt` (str): `<COMMIT_MESSAGE>…</COMMIT_MESSAGE>` + structured diff markup
- `response` (str): `"1"` if `regressor` else `"0"`

**Structured diff markup:** generated by `data_extraction/utils.py:diff_to_structured_xml()`.

## Typical regeneration order

1. `python data_extraction/bugzilla/get_all_bugs.py`
2. `python data_extraction/mercurial/fetch_all_commit.py` (copy/symlink output into `datasets/mozilla_jit/all_commits.jsonl`)
3. `python data_extraction/mercurial/link_bug_diffs.py` (writes `datasets/mozilla_jit/mozilla_jit.jsonl`)
4. `python data_extraction/data_preparation.py --mode mozilla_jit_struc` (writes `jit_llm_struc_2025.jsonl` by default)
